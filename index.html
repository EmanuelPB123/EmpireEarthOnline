<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Empire Earth Onliner</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        body,
        html {

            /* PC version */
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #1a1a1a;
            color: #e0e0e0;
        }

        #game-container {
            width: 100%;
            height: 100%;
        }

        #top-nav {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 40px;
            background: rgba(30, 30, 30, 0.9);
            color: #e0e0e0;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0 10px;
            z-index: 1000;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        #middle-nav {
            position: fixed;
            bottom: 90px;
            left: 0;
            width: 100%;
            height: 40px;
            background: rgba(30, 30, 30, 0.9);
            color: #e0e0e0;
            display: flex;
            align-items: center;
            justify-content: space-around;
            z-index: 1000;
            border: 1px solid #444;
        }

        #bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 90px;
            background: rgba(30, 30, 30, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            border-top: 1px solid #444;
        }

        #bottom-nav .button-grid {
            display: grid;
            gap: 0;
            justify-content: center;
        }

        .nav-button-container {
            position: relative;
        }

        .nav-button {
            width: 45px;
            height: 45px;
            font-size: 20px;
            padding: 0;
            background-color: #2a2a2a;
            color: #e0e0e0;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid #444;
            transition: all 0.3s ease;
        }

        .nav-button:hover {
            background-color: #3a3a3a;
        }

        .resource-info {
            display: none;
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(30, 30, 30, 0.9);
            color: #e0e0e0;
            padding: 5px 10px;
            border-radius: 3px;
            font-size: 14px;
            white-space: nowrap;
            pointer-events: none;
            z-index: 9999;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .nav-button-container:hover .resource-info {
            display: block;
        }

        #side-nav {
            position: fixed;
            top: 40px;
            left: 0;
            width: 180px;
            bottom: 136px;
            background: rgba(30, 30, 30, 0.9);
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 10px 0;
            z-index: 1000;
            border-right: 1px solid #444;
        }

        #side-nav .button-grid {
            display: grid;
            grid-template-columns: repeat(4, 45px);
            gap: 0px;
        }

        #side-nav .nav-button-container {
            margin-bottom: 0px;
            margin-left: 1px;
        }

        #side-nav .nav-button {
            width: 40px;
            height: 40px;
            font-size: 16px;
        }

        #side-nav .resource-info {
            left: 100%;
            top: 50%;
            transform: translateY(-50%);
            background-color: rgba(30, 30, 30, 0.9);
            color: #e0e0e0;
            padding: 5px;
            border-radius: 3px;
            white-space: nowrap;
            font-size: 12px;
            visibility: hidden;
            opacity: 0;
            transition: visibility 0s, opacity 0.3s linear;
        }

        .era-button {
            background-color: #3a3a3a;
            color: #e0e0e0;
            border: 1px solid #555;
            border-radius: 3px;
            padding: 8px 16px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .era-button:hover {
            background-color: #4a4a4a;
        }

        .era-button i {
            font-size: 18px;
        }

        #config-menu {
            position: absolute;
            top: 40%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(30, 30, 30, 0.95);
            color: #e0e0e0;
            padding: 20px;
            border-radius: 5px;
            text-align: center;
            border: 1px solid #444;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        }

        #config-menu input {
            width: 50px;
            margin-right: 10px;
            background-color: #2a2a2a;
            border: 1px solid #444;
            color: #e0e0e0;
            padding: 5px;
        }

        #config-menu button {
            margin-top: 20px;
        }

        #start-game {
            background-color: #4a4a4a;
            color: #e0e0e0;
            border: 1px solid #555;
            border-radius: 3px;
            padding: 10px 20px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        #start-game:hover {
            background-color: #5a5a5a;
        }

        #start-game::before {
            content: "\f144";
            font-family: "Font Awesome 5 Free";
            font-weight: 900;
        }

        .config-button {
            background-color: #3a3a3a;
            color: #e0e0e0;
            border: 1px solid #555;
            border-radius: 3px;
            padding: 8px 16px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .config-button:hover {
            background-color: #4a4a4a;
        }

        .config-button i {
            font-size: 18px;
        }

        /*Taber version */
        @media (max-width: 1024px) {
            #side-nav {
                width: 120px;
            }

            #side-nav .button-grid {
                grid-template-columns: repeat(2, 45px);
            }

            #bottom-nav {
                height: 80px;
            }

            .nav-button {
                width: 40px;
                height: 40px;
                font-size: 18px;
            }

            #middle-nav {
                bottom: 80px;
            }
        }

        /* Mobile version */
        @media (max-width: 768px) {
            #side-nav {
                width: 90px;
                bottom: 120px;
            }

            #side-nav .button-grid {
                grid-template-columns: repeat(2, 40px);
            }

            #side-nav .nav-button {
                width: 35px;
                height: 35px;
                font-size: 14px;
            }

            #bottom-nav {
                height: 70px;
            }

            #bottom-nav .button-grid {
                grid-template-columns: repeat(6, 35px);
            }

            .nav-button {
                width: 35px;
                height: 35px;
                font-size: 16px;
            }

            #middle-nav {
                bottom: 70px;
                height: 50px;
                flex-wrap: wrap;
                justify-content: space-evenly;
                padding: 5px 0;
            }

            .era-button {
                padding: 5px 10px;
                font-size: 14px;
            }

            #top-nav {
                height: 30px;
                font-size: 14px;
            }

            .resource-info {
                font-size: 12px;
                padding: 3px 6px;
            }
        }

        #side-nav .nav-button-container {
            display: block;
        }

        #side-nav.edad-prehistórica .nav-button-container[data-era="0"] {
            display: block;
        }

        #side-nav.edad-de-piedra .nav-button-container[data-era="0"],
        #side-nav.edad-de-piedra .nav-button-container[data-era="1"] {
            display: block;
        }

        #side-nav.edad-de-cobre .nav-button-container[data-era="0"],
        #side-nav.edad-de-cobre .nav-button-container[data-era="1"],
        #side-nav.edad-de-cobre .nav-button-container[data-era="2"] {
            display: block;
        }

        #side-nav.edad-de-bronce .nav-button-container[data-era="0"],
        #side-nav.edad-de-bronce .nav-button-container[data-era="1"],
        #side-nav.edad-de-bronce .nav-button-container[data-era="2"],
        #side-nav.edad-de-bronce .nav-button-container[data-era="3"] {
            display: block;
        }

        #side-nav.edad-oscura .nav-button-container[data-era="0"],
        #side-nav.edad-oscura .nav-button-container[data-era="1"],
        #side-nav.edad-oscura .nav-button-container[data-era="2"],
        #side-nav.edad-oscura .nav-button-container[data-era="3"],
        #side-nav.edad-oscura .nav-button-container[data-era="4"] {
            display: block;
        }

        #side-nav.edad-media .nav-button-container[data-era="0"],
        #side-nav.edad-media .nav-button-container[data-era="1"],
        #side-nav.edad-media .nav-button-container[data-era="2"],
        #side-nav.edad-media .nav-button-container[data-era="3"],
        #side-nav.edad-media .nav-button-container[data-era="4"],
        #side-nav.edad-media .nav-button-container[data-era="5"] {
            display: block;
        }

        #side-nav.renacimiento .nav-button-container[data-era="0"],
        #side-nav.renacimiento .nav-button-container[data-era="1"],
        #side-nav.renacimiento .nav-button-container[data-era="2"],
        #side-nav.renacimiento .nav-button-container[data-era="3"],
        #side-nav.renacimiento .nav-button-container[data-era="4"],
        #side-nav.renacimiento .nav-button-container[data-era="5"],
        #side-nav.renacimiento .nav-button-container[data-era="6"] {
            display: block;
        }

        #side-nav.edad-imperial .nav-button-container[data-era="0"],
        #side-nav.edad-imperial .nav-button-container[data-era="1"],
        #side-nav.edad-imperial .nav-button-container[data-era="2"],
        #side-nav.edad-imperial .nav-button-container[data-era="3"],
        #side-nav.edad-imperial .nav-button-container[data-era="4"],
        #side-nav.edad-imperial .nav-button-container[data-era="5"],
        #side-nav.edad-imperial .nav-button-container[data-era="6"],
        #side-nav.edad-imperial .nav-button-container[data-era="7"] {
            display: block;
        }

        #side-nav.edad-industrial .nav-button-container[data-era="0"],
        #side-nav.edad-industrial .nav-button-container[data-era="1"],
        #side-nav.edad-industrial .nav-button-container[data-era="2"],
        #side-nav.edad-industrial .nav-button-container[data-era="3"],
        #side-nav.edad-industrial .nav-button-container[data-era="4"],
        #side-nav.edad-industrial .nav-button-container[data-era="5"],
        #side-nav.edad-industrial .nav-button-container[data-era="6"],
        #side-nav.edad-industrial .nav-button-container[data-era="7"],
        #side-nav.edad-industrial .nav-button-container[data-era="8"] {
            display: block;
        }

        #side-nav.edad-atómica-igm .nav-button-container[data-era="0"],
        #side-nav.edad-atómica-igm .nav-button-container[data-era="1"],
        #side-nav.edad-atómica-igm .nav-button-container[data-era="2"],
        #side-nav.edad-atómica-igm .nav-button-container[data-era="3"],
        #side-nav.edad-atómica-igm .nav-button-container[data-era="4"],
        #side-nav.edad-atómica-igm .nav-button-container[data-era="5"],
        #side-nav.edad-atómica-igm .nav-button-container[data-era="6"],
        #side-nav.edad-atómica-igm .nav-button-container[data-era="7"],
        #side-nav.edad-atómica-igm .nav-button-container[data-era="8"],
        #side-nav.edad-atómica-igm .nav-button-container[data-era="9"] {
            display: block;
        }

        #side-nav.edad-atómica-iigm .nav-button-container[data-era="0"],
        #side-nav.edad-atómica-iigm .nav-button-container[data-era="1"],
        #side-nav.edad-atómica-iigm .nav-button-container[data-era="2"],
        #side-nav.edad-atómica-iigm .nav-button-container[data-era="3"],
        #side-nav.edad-atómica-iigm .nav-button-container[data-era="4"],
        #side-nav.edad-atómica-iigm .nav-button-container[data-era="5"],
        #side-nav.edad-atómica-iigm .nav-button-container[data-era="6"],
        #side-nav.edad-atómica-iigm .nav-button-container[data-era="7"],
        #side-nav.edad-atómica-iigm .nav-button-container[data-era="8"],
        #side-nav.edad-atómica-iigm .nav-button-container[data-era="9"],
        #side-nav.edad-atómica-iigm .nav-button-container[data-era="10"] {
            display: block;
        }

        #side-nav.edad-atómica-moderna .nav-button-container[data-era="0"],
        #side-nav.edad-atómica-moderna .nav-button-container[data-era="1"],
        #side-nav.edad-atómica-moderna .nav-button-container[data-era="2"],
        #side-nav.edad-atómica-moderna .nav-button-container[data-era="3"],
        #side-nav.edad-atómica-moderna .nav-button-container[data-era="4"],
        #side-nav.edad-atómica-moderna .nav-button-container[data-era="5"],
        #side-nav.edad-atómica-moderna .nav-button-container[data-era="6"],
        #side-nav.edad-atómica-moderna .nav-button-container[data-era="7"],
        #side-nav.edad-atómica-moderna .nav-button-container[data-era="8"],
        #side-nav.edad-atómica-moderna .nav-button-container[data-era="9"],
        #side-nav.edad-atómica-moderna .nav-button-container[data-era="10"],
        #side-nav.edad-atómica-moderna .nav-button-container[data-era="11"] {
            display: block;
        }

        #side-nav.edad-digital .nav-button-container[data-era="0"],
        #side-nav.edad-digital .nav-button-container[data-era="1"],
        #side-nav.edad-digital .nav-button-container[data-era="2"],
        #side-nav.edad-digital .nav-button-container[data-era="3"],
        #side-nav.edad-digital .nav-button-container[data-era="4"],
        #side-nav.edad-digital .nav-button-container[data-era="5"],
        #side-nav.edad-digital .nav-button-container[data-era="6"],
        #side-nav.edad-digital .nav-button-container[data-era="7"],
        #side-nav.edad-digital .nav-button-container[data-era="8"],
        #side-nav.edad-digital .nav-button-container[data-era="9"],
        #side-nav.edad-digital .nav-button-container[data-era="10"],
        #side-nav.edad-digital .nav-button-container[data-era="11"],
        #side-nav.edad-digital .nav-button-container[data-era="12"] {
            display: block;
        }

        #side-nav.nano-edad .nav-button-container[data-era="0"],
        #side-nav.nano-edad .nav-button-container[data-era="1"],
        #side-nav.nano-edad .nav-button-container[data-era="2"],
        #side-nav.nano-edad .nav-button-container[data-era="3"],
        #side-nav.nano-edad .nav-button-container[data-era="4"],
        #side-nav.nano-edad .nav-button-container[data-era="5"],
        #side-nav.nano-edad .nav-button-container[data-era="6"],
        #side-nav.nano-edad .nav-button-container[data-era="7"],
        #side-nav.nano-edad .nav-button-container[data-era="8"],
        #side-nav.nano-edad .nav-button-container[data-era="9"],
        #side-nav.nano-edad .nav-button-container[data-era="10"],
        #side-nav.nano-edad .nav-button-container[data-era="11"],
        #side-nav.nano-edad .nav-button-container[data-era="12"],
        #side-nav.nano-edad .nav-button-container[data-era="13"] {
            display: block;
        }

        #side-nav.era-espacial .nav-button-container {
            display: block;
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
</head>

<body>
    <div id="game-container"></div>

    <nav id="top-nav">
        <div style="flex: 1;"></div> <!-- Espacio flexible a la izquierda -->
        <p style="flex: 1; text-align: center;font-size: x-large;font-family: Arial black, Helvetica, sans-serif;"><span
                id="era-name">Prehistoria</span></p>
        <div style="flex: 1; display: flex; justify-content: flex-end; padding-right: 40px;">
            <button id="open-config" class="config-button">
                <i class="fas fa-cog"></i>
                Configuración Inicial
            </button>
        </div>
    </nav>


    <nav id="side-nav" class="edad-prehistorica">
        <div class="button-grid">
            <!-- Los botones de unidades se generarán aquí dinámicamente -->
        </div>
    </nav>


    <nav id="middle-nav">
        <button id="advance-era" class="era-button">
            <i class="fas fa-chevron-up"></i>
            <span>Avanzar Era</span>
        </button>
        <p>Población: <span id="population">0</span></p>
        <p>Alimento: <span id="food">0</span></p>
        <p>Madera: <span id="wood">0</span></p>
        <p>Piedra: <span id="stone">0</span></p>
        <p>Oro: <span id="gold">0</span></p>
    </nav>

    <nav id="bottom-nav" class="edad-prehistorica">
        <div class="button-grid">
            <!-- Los botones se generarán dinámicamente con JavaScript -->
        </div>
    </nav>

    <div id="config-menu" style="display: none;">
        <!--         <h3>Configuración de Partida</h3> -->
        <p>
            <label for="initial-food">Alimento inicial:</label>
            <input type="number" id="initial-food" value="300" min="0" max="600" class="resource-input" data-max="600">
        </p>
        <p>
            <label for="initial-wood">Madera inicial:</label>
            <input type="number" id="initial-wood" value="500" min="0" max="1000" class="resource-input"
                data-max="1000">
        </p>
        <p>
            <label for="initial-stone">Piedra inicial:</label>
            <input type="number" id="initial-stone" value="150" min="0" max="300" class="resource-input" data-max="300">
        </p>
        <p>
            <label for="initial-gold">Oro inicial:</label>
            <input type="number" id="initial-gold" value="50" min="0" max="100" class="resource-input" data-max="100">
        </p>
        <p>
            <label for="food-nodes">Alimento:</label>
            <input type="number" id="food-nodes" value="10" min="0" max="20" class="resource-node-input" data-max="50">
        </p>
        <p>
            <label for="wood-nodes">Madera:</label>
            <input type="number" id="wood-nodes" value="125" min="0" max="250" class="resource-node-input"
                data-max="500">
        </p>
        <p>
            <label for="stone-nodes">Piedra:</label>
            <input type="number" id="stone-nodes" value="15" min="0" max="30" class="resource-node-input"
                data-max="100">
        </p>
        <p>
            <label for="gold-nodes">Oro:</label>
            <input type="number" id="gold-nodes" value="10" min="0" max="20" class="resource-node-input" data-max="50">
        </p>
        <button id="start-game">Comenzar Partida</button>
    </div>
    <div id="hover-info"></div>
    <script>
        let moveForward = false;
        let moveBackward = false;
        let moveLeft = false;
        let moveRight = false;
        const moveSpeed = 7;
        const cameraHeight = 100; // Altura constante de la cámara
        let scene, camera, renderer, raycaster, mouse;
        let base, resourceNodes = [], units = [], buildings = [];
        let currentEra = 0;
        const eras = [
            { name: 'Edad Prehistórica', color: 0x8B4513 },
            { name: 'Edad de Piedra', color: 0x8B4513 },
            { name: 'Edad de Cobre', color: 0x8B4513 },
            { name: 'Edad de Bronce', color: 0x8B4513 },
            { name: 'Edad Oscura', color: 0x8B4513 },
            { name: 'Edad Media', color: 0x8B4513 },
            { name: 'Renacimiento', color: 0x8B4513 },
            { name: 'Edad Imperial', color: 0x8B4513 },
            { name: 'Edad Industrial', color: 0x8B4513 },
            { name: 'Edad Atómica (IGM)', color: 0x8B4513 },
            { name: 'Edad Atómica (IIGM)', color: 0x8B4513 },
            { name: 'Edad Atómica (Moderna)', color: 0x8B4513 },
            { name: 'Edad Digital', color: 0x8B4513 },
            { name: 'Nano Edad', color: 0x8B4513 },
            { name: 'Era Espacial', color: 0x8B4513 }
        ];
        let resources = {
            food: 0,
            wood: 0,
            stone: 0,
            gold: 0
        };
        let gameStarted = false;
        const buildingButtons = [
            // Edad Prehistórica
            { id: 'build-house', icon: 'fas fa-home', name: 'Casa', cost: '30 madera, 20 piedra' },

            // Edad de Piedra
            { id: 'build-farm', icon: 'fas fa-tractor', name: 'Granja', cost: '40 madera, 20 piedra' },

            // Edad de Cobre
            { id: 'build-mine', icon: 'fas fa-gem', name: 'Mina', cost: '60 madera, 40 piedra' },

            // Edad de Bronce
            { id: 'build-barracks', icon: 'fas fa-fort-awesome', name: 'Cuartel', cost: '50 madera, 30 piedra' },

            // Edad Oscura
            { id: 'build-tower', icon: 'fas fa-chess-rook', name: 'Torre', cost: '80 piedra, 40 madera' },

            // Edad Media
            { id: 'build-workshop', icon: 'fas fa-hammer', name: 'Taller', cost: '80 madera, 60 piedra' },
            { id: 'build-castle', icon: 'fas fa-chess-rook', name: 'Castillo', cost: '300 piedra, 200 madera, 100 oro' },

            // Renacimiento
            { id: 'build-market', icon: 'fas fa-store', name: 'Mercado', cost: '70 madera, 50 piedra, 20 oro' },
            { id: 'build-dock', icon: 'fas fa-ship', name: 'Muelle', cost: '100 madera, 30 piedra' },

            // Edad Imperial
            { id: 'build-temple', icon: 'fas fa-place-of-worship', name: 'Templo', cost: '100 piedra, 50 oro' },
            { id: 'build-university', icon: 'fas fa-university', name: 'Universidad', cost: '150 piedra, 100 madera, 50 oro' },

            // Edad Industrial
            { id: 'build-factory', icon: 'fas fa-industry', name: 'Fábrica', cost: '200 piedra, 150 madera, 80 oro' },

            // Edad Atómica (IGM)
            { id: 'build-laboratory', icon: 'fas fa-flask', name: 'Laboratorio', cost: '180 piedra, 120 madera, 100 oro' },

            // Edad Atómica (IIGM)
            // No hay nuevos edificios en esta era

            // Edad Atómica (Moderna)
            { id: 'build-quantum-computer', icon: 'fas fa-atom', name: 'Computadora Cuántica', cost: '600 piedra, 400 madera, 500 oro' },

            // Edad Digital
            { id: 'build-ai-core', icon: 'fas fa-brain', name: 'Núcleo IA', cost: '500 piedra, 300 madera, 400 oro' },

            // Nano Edad
            { id: 'build-fusion-reactor', icon: 'fas fa-atom', name: 'Reactor de Fusión', cost: '700 piedra, 500 madera, 600 oro' },

            // Era Espacial
            { id: 'build-spaceport', icon: 'fas fa-rocket', name: 'Puerto Espacial', cost: '500 piedra, 300 madera, 200 oro' },
            { id: 'build-space-elevator', icon: 'fas fa-space-shuttle', name: 'Elevador Espacial', cost: '1000 piedra, 800 madera, 1000 oro' },
        ];
        function init() {
            scene = new THREE.Scene();
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 5000);
            renderer = new THREE.WebGLRenderer();
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.getElementById('game-container').appendChild(renderer.domElement);

            raycaster = new THREE.Raycaster();
            mouse = new THREE.Vector2();

            createTerrain();
            setupLighting();
            setupCamera();
            setupKeyControls();

            updateUnitButtons();
            updateBuildingButtons();
        }

        /* MAXIMO RECURSOS BASE*/
        document.querySelectorAll('.resource-input').forEach(input => {
            const validateInput = function () {
                let value = parseInt(this.value);
                if (isNaN(value)) {
                    value = 0;
                }
                const max = parseInt(this.dataset.max);
                value = Math.min(max, Math.max(0, value));
                this.value = value;
            };

            input.addEventListener('input', validateInput);
            input.addEventListener('change', validateInput);
            input.addEventListener('blur', validateInput);
            input.addEventListener('keyup', function (e) {
                if (e.key === 'Enter') {
                    validateInput.call(this);
                }
            });
        });
        /* MaXIMO RECURSOS MAPA */
        document.querySelectorAll('.resource-node-input').forEach(input => {
            const validateInput = function () {
                let value = parseInt(this.value);
                if (isNaN(value)) {
                    value = 0;
                }
                const max = parseInt(this.dataset.max);
                value = Math.min(max, Math.max(0, value));
                this.value = value;
            };

            input.addEventListener('input', validateInput);
            input.addEventListener('change', validateInput);
            input.addEventListener('blur', validateInput);
            input.addEventListener('keyup', function (e) {
                if (e.key === 'Enter') {
                    validateInput.call(this);
                }
            });
        });

        function setupCamera() {
            camera.position.set(0, cameraHeight, 200);
            camera.lookAt(0, 0, 0);
        }
        /* CAMARA */
        function setupCamera() {
            camera.position.set(0, cameraHeight, 200);
            camera.lookAt(0, 0, 0);
        }
        /* CONTROLES */
        function setupKeyControls() {
            document.addEventListener('keydown', onKeyDown, false);
            document.addEventListener('keyup', onKeyUp, false);
        }
        function onKeyDown(event) {
            switch (event.keyCode) {
                case 87: // W
                    moveForward = true;
                    break;
                case 83: // S
                    moveBackward = true;
                    break;
                case 65: // A
                    moveLeft = true;
                    break;
                case 68: // D
                    moveRight = true;
                    break;
            }
        }
        function onKeyUp(event) {
            switch (event.keyCode) {
                case 87: // W
                    moveForward = false;
                    break;
                case 83: // S
                    moveBackward = false;
                    break;
                case 65: // A
                    moveLeft = false;
                    break;
                case 68: // D
                    moveRight = false;
                    break;
            }
        }
        function updateCamera() {
            if (moveForward) camera.position.z -= moveSpeed;
            if (moveBackward) camera.position.z += moveSpeed;
            if (moveLeft) camera.position.x -= moveSpeed;
            if (moveRight) camera.position.x += moveSpeed;

            camera.position.y = cameraHeight; // Mantener altura constante

            // Ajusta estos valores para cambiar el ángulo de la cámara
            const lookAtHeight = 0; // Mira hacia el suelo
            const lookAtDistance = 200; // Distancia del punto de mira

            camera.lookAt(
                camera.position.x,
                lookAtHeight,
                camera.position.z - lookAtDistance
            );

            // console.log('Posición de la cámara:', camera.position); // Comenta esta línea si no necesitas el log constante
        }

        /* TeRRENO */
        function createTerrain() {
            const geometry = new THREE.PlaneGeometry(10000, 10000);
            const material = new THREE.MeshStandardMaterial({ color: 0x4CAF50 });
            const terrain = new THREE.Mesh(geometry, material);
            terrain.rotation.x = -Math.PI / 2;
            scene.add(terrain);
        }
        /* LUZ */
        function setupLighting() {
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.5);
            scene.add(ambientLight);

            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.5);
            directionalLight.position.set(0, 1, 0);
            scene.add(directionalLight);
        }

        function updateUnitButtons() {
            console.log('Actualizando botones de unidades. Era actual:', currentEra);
            const buttonGrid = document.querySelector('#side-nav .button-grid');
            if (!buttonGrid) {
                console.error('No se encontró el elemento .button-grid dentro de #side-nav');
                return;
            }
            buttonGrid.innerHTML = ''; // Limpiar botones existentes

            const unitButtons = [
                { id: 'create-worker', icon: 'fas fa-user', name: 'Ciudadano', cost: '20 alimento', era: 0 },

                { id: 'create-scout', icon: 'fas fa-eye', name: 'Explorador', cost: '25 alimento', era: 3 },
                { id: 'create-soldier', icon: 'fas fa-shield-alt', name: 'Soldado', cost: '30 alimento, 10 oro', era: 3 },
                { id: 'create-archer', icon: 'fas fa-bullseye', name: 'Arquero', cost: '40 alimento, 20 madera', era: 3 },
                { id: 'create-spearman', icon: 'fas fa-khanda', name: 'Lancero', cost: '35 alimento, 15 madera', era: 3 },
                { id: 'create-spearman', icon: 'fas fa-khanda', name: 'Lancero', cost: '35 alimento, 15 madera', era: 3 },

                { id: 'create-knight', icon: 'fas fa-chess-knight', name: 'Caballero', cost: '60 alimento, 40 oro', era: 5 },
                { id: 'create-longbowman', icon: 'fas fa-bullseye', name: 'Arquero largo', cost: '45 alimento, 30 madera', era: 5 },
                { id: 'create-pikeman', icon: 'fas fa-khanda', name: 'Piquero', cost: '40 alimento, 25 madera', era: 5 },
                { id: 'create-knight', icon: 'fas fa-chess-knight', name: 'Caballero', cost: '60 alimento, 40 oro', era: 5 },
                { id: 'create-longbowman', icon: 'fas fa-bullseye', name: 'Arquero largo', cost: '45 alimento, 30 madera', era: 5 },
                { id: 'create-knight', icon: 'fas fa-chess-knight', name: 'Caballero', cost: '60 alimento, 40 oro', era: 5 },
                { id: 'create-longbowman', icon: 'fas fa-bullseye', name: 'Arquero largo', cost: '45 alimento, 30 madera', era: 5 },
                { id: 'create-pikeman', icon: 'fas fa-khanda', name: 'Piquero', cost: '40 alimento, 25 madera', era: 5 },
                { id: 'create-knight', icon: 'fas fa-chess-knight', name: 'Caballero', cost: '60 alimento, 40 oro', era: 5 },
                { id: 'create-longbowman', icon: 'fas fa-bullseye', name: 'Arquero largo', cost: '45 alimento, 30 madera', era: 5 },

                { id: 'create-crossbowman', icon: 'fas fa-crosshairs', name: 'Ballestero', cost: '40 alimento, 35 madera', era: 6 },
                { id: 'create-halberdier', icon: 'fas fa-axe', name: 'Alabardero', cost: '45 alimento, 30 madera', era: 6 },
                { id: 'create-crossbowman', icon: 'fas fa-crosshairs', name: 'Ballestero', cost: '40 alimento, 35 madera', era: 6 },
                { id: 'create-halberdier', icon: 'fas fa-axe', name: 'Alabardero', cost: '45 alimento, 30 madera', era: 6 },
                { id: 'create-crossbowman', icon: 'fas fa-crosshairs', name: 'Ballestero', cost: '40 alimento, 35 madera', era: 6 },
                { id: 'create-halberdier', icon: 'fas fa-axe', name: 'Alabardero', cost: '45 alimento, 30 madera', era: 6 },
                { id: 'create-crossbowman', icon: 'fas fa-crosshairs', name: 'Ballestero', cost: '40 alimento, 35 madera', era: 6 },
                { id: 'create-halberdier', icon: 'fas fa-axe', name: 'Alabardero', cost: '45 alimento, 30 madera', era: 6 },
                { id: 'create-crossbowman', icon: 'fas fa-crosshairs', name: 'Ballestero', cost: '40 alimento, 35 madera', era: 6 },
                { id: 'create-halberdier', icon: 'fas fa-axe', name: 'Alabardero', cost: '45 alimento, 30 madera', era: 6 },


                { id: 'create-rifleman', icon: 'fas fa-user-secret', name: 'Fusilero', cost: '40 alimento, 40 oro', era: 8 },
                { id: 'create-grenadier', icon: 'fas fa-bomb', name: 'Granadero', cost: '50 alimento, 35 oro', era: 8 },
                { id: 'create-cavalry-officer', icon: 'fas fa-horse', name: 'Oficial de caballería', cost: '70 alimento, 50 oro', era: 8 },
                { id: 'create-field-gun', icon: 'fas fa-bullseye', name: 'Cañón de campaña', cost: '140 madera, 80 oro', era: 8 },
                { id: 'create-field-gun', icon: 'fas fa-bullseye', name: 'Cañón de campaña', cost: '140 madera, 80 oro', era: 8 },

                { id: 'create-nanobot', icon: 'fas fa-microchip', name: 'Nanobot', cost: '200 oro, 150 piedra', era: 13 },
                { id: 'create-mech', icon: 'fas fa-robot', name: 'Mecha', cost: '300 oro, 200 piedra', era: 13 },
                { id: 'create-plasma-tank', icon: 'fas fa-atom', name: 'Tanque de plasma', cost: '350 oro, 250 piedra', era: 13 },
                { id: 'create-energy-shield', icon: 'fas fa-shield-alt', name: 'Escudo de energía', cost: '250 oro, 150 piedra', era: 13 },
                { id: 'create-energy-shield', icon: 'fas fa-shield-alt', name: 'Escudo de energía', cost: '250 oro, 150 piedra', era: 13 },

                { id: 'create-spaceship', icon: 'fas fa-rocket', name: 'Nave espacial', cost: '500 oro, 300 piedra', era: 14 },
                { id: 'create-starfighter', icon: 'fas fa-user-astronaut', name: 'Caza estelar', cost: '400 oro, 250 piedra', era: 14 },
                { id: 'create-orbital-cannon', icon: 'fas fa-satellite', name: 'Cañón orbital', cost: '600 oro, 400 piedra', era: 14 },
                { id: 'create-gravity-manipulator', icon: 'fas fa-globe', name: 'Manipulador gravitacional', cost: '550 oro, 350 piedra', era: 14 },
                { id: 'create-time-distorter', icon: 'fas fa-hourglass', name: 'Distorsionador temporal', cost: '700 oro, 500 piedra', era: 14 },
            ];

            for (let button of unitButtons) {
                if (button.era <= currentEra) {
                    const buttonHTML = `
    <div class="nav-button-container" data-era="${button.era}">
        <button class="nav-button" id="${button.id}"><i class="${button.icon}"></i></button>
        <div class="resource-info">${button.name}: ${button.cost}</div>
    </div>
`;
                    buttonGrid.innerHTML += buttonHTML;
                }
            }

            addUnitEventListeners();
        }

        function updateBuildingButtons() {
            const buttonGrid = document.querySelector('#bottom-nav .button-grid');
            buttonGrid.innerHTML = ''; // Limpiar botones existentes

            let numButtons;
            switch (currentEra) {
                case 0: numButtons = 1; break; // Edad Prehistórica
                case 1: numButtons = 2; break; // Edad de Piedra
                case 2: numButtons = 3; break; // Edad de Cobre
                case 3: numButtons = 4; break; // Edad de Bronce
                case 4: numButtons = 5; break; // Edad Oscura
                case 5: numButtons = 7; break; // Edad Media
                case 6: numButtons = 9; break; // Renacimiento
                case 7: numButtons = 11; break; // Edad Imperial
                case 8: numButtons = 12; break; // Edad Industrial
                case 9: numButtons = 13; break; // Edad Atómica (IGM)
                case 10: numButtons = 13; break; // Edad Atómica (IIGM)
                case 11: numButtons = 14; break; // Edad Atómica (Moderna)
                case 12: numButtons = 15; break; // Edad Digital
                case 13: numButtons = 16; break; // Nano Edad
                case 14: numButtons = 18; break; // Era Espacial
                default: numButtons = buildingButtons.length; break;
            }

            for (let i = 0; i < numButtons && i < buildingButtons.length; i++) {
                const button = buildingButtons[i];
                const buttonHTML = `
                    <div class="nav-button-container">
                        <button class="nav-button" id="${button.id}"><i class="${button.icon}"></i></button>
                        <div class="resource-info">${button.name}: ${button.cost}</div>
                    </div>
                `;
                buttonGrid.innerHTML += buttonHTML;
            }

            // Actualizar el estilo del grid
            const columns = Math.min(numButtons, 9);
            const rows = Math.ceil(numButtons / 9);
            buttonGrid.style.gridTemplateColumns = `repeat(${columns}, 45px)`;
            buttonGrid.style.gridTemplateRows = `repeat(${rows}, 45px)`;

            addBuildingEventListeners();
        }

        function addUnitEventListeners() {
            const unitButtons = document.querySelectorAll('#side-nav .nav-button');
            unitButtons.forEach(button => {
                button.addEventListener('click', () => createUnit(button.id.replace('create-', '')));
            });
        }

        function addBuildingEventListeners() {
            buildingButtons.forEach(button => {
                const element = document.getElementById(button.id);
                if (element) {
                    element.addEventListener('click', () => createBuilding(button.id.replace('build-', '')));
                }
            });
        }

        function advanceEra() {
            if (currentEra < eras.length - 1 &&
                resources.food >= 100 && resources.wood >= 50 && resources.stone >= 50 && resources.gold >= 50) {
                resources.food -= 100;
                resources.wood -= 50;
                resources.stone -= 50;
                resources.gold -= 50;

                currentEra++;
                document.getElementById('era-name').textContent = eras[currentEra].name;

                base.upgrade();
                units.forEach(unit => unit.evolve());

                updateResourceDisplay();

                const bottomNav = document.getElementById('bottom-nav');
                bottomNav.className = eras[currentEra].name.toLowerCase().replace(/ /g, '-');

                const sideNav = document.getElementById('side-nav');
                sideNav.className = eras[currentEra].name.toLowerCase().replace(/ /g, '-');
                updateUnitButtons();
                updateBuildingButtons();
            }
        }

        function updateResourceDisplay() {
            for (let resource in resources) {
                document.getElementById(resource).textContent = resources[resource];
            }
        }

        function startGame() {
            resources.food = parseInt(document.getElementById('initial-food').value);
            resources.wood = parseInt(document.getElementById('initial-wood').value);
            resources.stone = parseInt(document.getElementById('initial-stone').value);
            resources.gold = parseInt(document.getElementById('initial-gold').value);

            createResourceNodes();
            updateResourceDisplay();
            document.getElementById('config-menu').style.display = 'none';
            gameStarted = true;

            base = new Base();
            animate();

            updateUnitButtons();
            updateBuildingButtons();
        }

        class Base {
            constructor() {
                this.level = 1;
                this.mesh = this.createMesh();
                scene.add(this.mesh);
            }

            createMesh() {
                const geometry = new THREE.BoxGeometry(10, 20, 10);
                const material = new THREE.MeshStandardMaterial({ color: eras[currentEra].color });
                const mesh = new THREE.Mesh(geometry, material);
                mesh.position.set(0, 10, 0);
                return mesh;
            }

            upgrade() {
                this.level++;
                scene.remove(this.mesh);
                this.mesh = this.createMesh();
                this.mesh.scale.set(1 + this.level * 0.1, 1 + this.level * 0.1, 1 + this.level * 0.1);
                scene.add(this.mesh);
            }
        }

        class Unit {
            constructor(type) {
                this.type = type;
                this.mesh = this.createMesh();
                scene.add(this.mesh);
            }

            createMesh() {
                const geometry = new THREE.SphereGeometry(2, 32, 32);
                const material = new THREE.MeshStandardMaterial({ color: this.getColor() });
                const mesh = new THREE.Mesh(geometry, material);
                mesh.position.set(Math.random() * 100 - 50, 2, Math.random() * 100 - 50);
                return mesh;
            }

            getColor() {
                switch (this.type) {
                    case 'worker': return 0x0000FF;
                    case 'soldier': return 0xFF0000;
                    default: return 0xFFFFFF;
                }
            }

            evolve() {
                scene.remove(this.mesh);
                this.mesh = this.createMesh();
                scene.add(this.mesh);
            }
        }

        class Building {
            constructor(type, position) {
                this.type = type;
                this.mesh = this.createMesh(position);
                scene.add(this.mesh);
            }

            createMesh(position) {
                let geometry, color;
                switch (this.type) {
                    case 'barracks':
                        geometry = new THREE.BoxGeometry(10, 8, 10);
                        color = 0x8B0000;
                        break;
                    case 'farm':
                        geometry = new THREE.CylinderGeometry(5, 5, 6, 8);
                        color = 0x228B22;
                        break;
                    case 'mine':
                        geometry = new THREE.ConeGeometry(5, 10, 4);
                        color = 0x708090;
                        break;
                    case 'house':
                        geometry = new THREE.BoxGeometry(8, 6, 8);
                        color = 0xA0522D;
                        break;
                    case 'market':
                        geometry = new THREE.BoxGeometry(12, 5, 12);
                        color = 0xFFD700;
                        break;
                    case 'temple':
                        geometry = new THREE.CylinderGeometry(6, 8, 12, 6);
                        color = 0xFFFFFF;
                        break;
                    case 'tower':
                        geometry = new THREE.CylinderGeometry(3, 5, 15, 8);
                        color = 0x808080;
                        break;
                    case 'workshop':
                        geometry = new THREE.BoxGeometry(10, 7, 10);
                        color = 0x8B4513;
                        break;
                    case 'dock':
                        geometry = new THREE.BoxGeometry(15, 3, 8);
                        color = 0x4682B4;
                        break;
                    case 'university':
                        geometry = new THREE.BoxGeometry(14, 10, 14);
                        color = 0x800080;
                        break;
                    case 'castle':
                        geometry = new THREE.BoxGeometry(20, 25, 20);
                        color = 0x696969;
                        break;
                    case 'factory':
                        geometry = new THREE.BoxGeometry(16, 12, 16);
                        color = 0xB22222;
                        break;
                    case 'laboratory':
                        geometry = new THREE.SphereGeometry(8, 32, 32);
                        color = 0x00FFFF;
                        break;
                    case 'spaceport':
                        geometry = new THREE.ConeGeometry(10, 20, 32);
                        color = 0xC0C0C0;
                        break;
                    case 'nanofabricator':
                        geometry = new THREE.OctahedronGeometry(8);
                        color = 0x32CD32;
                        break;
                    default:
                        geometry = new THREE.BoxGeometry(8, 8, 8);
                        color = 0x808080;
                }
                const material = new THREE.MeshStandardMaterial({ color: color });
                const mesh = new THREE.Mesh(geometry, material);
                mesh.position.copy(position);
                mesh.position.y = geometry.parameters.height / 2;
                return mesh;
            }
        }

        function createUnit(type) {
            let cost;
            switch (type) {
                case 'worker':
                    cost = { food: 20 };
                    break;
                case 'soldier':
                    cost = { food: 30, gold: 10 };
                    break;
                default:
                    return;
            }

            if (canAfford(cost)) {
                deductResources(cost);
                units.push(new Unit(type));
                updateResourceDisplay();
                updatePopulation();
            }
        }

        function createBuilding(type) {
            let cost;
            switch (type) {
                case 'barracks':
                    cost = { wood: 50, stone: 30 };
                    break;
                case 'farm':
                    cost = { wood: 40, stone: 20 };
                    break;
                case 'mine':
                    cost = { wood: 60, stone: 40 };
                    break;
                case 'house':
                    cost = { wood: 30, stone: 20 };
                    break;
                case 'market':
                    cost = { wood: 70, stone: 50, gold: 20 };
                    break;
                case 'temple':
                    cost = { stone: 100, gold: 50 };
                    break;
                case 'tower':
                    cost = { stone: 80, wood: 40 };
                    break;
                case 'workshop':
                    cost = { wood: 80, stone: 60 };
                    break;
                case 'dock':
                    cost = { wood: 100, stone: 30 };
                    break;
                case 'university':
                    cost = { stone: 150, wood: 100, gold: 50 };
                    break;
                case 'castle':
                    cost = { stone: 300, wood: 200, gold: 100 };
                    break;
                case 'factory':
                    cost = { stone: 200, wood: 150, gold: 80 };
                    break;
                case 'laboratory':
                    cost = { stone: 180, wood: 120, gold: 100 };
                    break;
                case 'spaceport':
                    cost = { stone: 500, wood: 300, gold: 200 };
                    break;
                case 'nanofabricator':
                    cost = { stone: 400, wood: 250, gold: 300 };
                    break;
                default:
                    return;
            }

            if (canAfford(cost)) {
                deductResources(cost);
                const position = new THREE.Vector3(Math.random() * 100 - 50, 0, Math.random() * 100 - 50);
                buildings.push(new Building(type, position));
                updateResourceDisplay();
            }
        }

        function canAfford(cost) {
            return Object.entries(cost).every(([resource, amount]) => resources[resource] >= amount);
        }

        function deductResources(cost) {
            Object.entries(cost).forEach(([resource, amount]) => resources[resource] -= amount);
        }

        function createResourceNodes() {
            const foodNodes = parseInt(document.getElementById('food-nodes').value);
            const woodNodes = parseInt(document.getElementById('wood-nodes').value);
            const stoneNodes = parseInt(document.getElementById('stone-nodes').value);
            const goldNodes = parseInt(document.getElementById('gold-nodes').value);

            for (let i = 0; i < foodNodes; i++) createResourceNode('food');
            for (let i = 0; i < woodNodes; i++) createResourceNode('wood');
            for (let i = 0; i < stoneNodes; i++) createResourceNode('stone');
            for (let i = 0; i < goldNodes; i++) createResourceNode('gold');
        }


        const BASE_SCALE = 2; // Escala base para la comida

        function createResourceNode(type) {
            let mesh;
            const terrainSize = 10000;
            const halfSize = terrainSize / 2;

            switch (type) {
                case 'food':
                    // Comida: mantiene la escala base
                    const foodGeometry = new THREE.SphereGeometry(3, 32, 32);
                    const foodMaterial = new THREE.MeshStandardMaterial({ color: 0x00FF00, metalness: 0.7, roughness: 0.3 });
                    mesh = new THREE.Mesh(foodGeometry, foodMaterial);

                    const numSpheres = 10;
                    for (let i = 0; i < numSpheres; i++) {
                        const smallSphere = new THREE.Mesh(
                            new THREE.SphereGeometry(0.3, 16, 16),
                            new THREE.MeshStandardMaterial({ color: 0xFF0000, metalness: 0.7, roughness: 0.3 })
                        );

                        const phi = Math.acos(-1 + (2 * i) / numSpheres);
                        const theta = Math.sqrt(numSpheres * Math.PI) * phi;

                        smallSphere.position.setFromSpherical(new THREE.Spherical(3, phi, theta));
                        mesh.add(smallSphere);
                    }
                    mesh.scale.multiplyScalar(BASE_SCALE);
                    break;

                case 'wood':
                    // Pino: 3 veces más grande que piedra y oro (6 veces la escala base)
                    const trunkGeometry = new THREE.CylinderGeometry(0.5, 1, 4, 8);
                    const trunkMaterial = new THREE.MeshStandardMaterial({ color: 0x8B4513 });
                    const trunk = new THREE.Mesh(trunkGeometry, trunkMaterial);

                    const leavesGeometry = new THREE.ConeGeometry(3, 6, 8);
                    const leavesMaterial = new THREE.MeshStandardMaterial({ color: 0x228B22 });
                    const leaves = new THREE.Mesh(leavesGeometry, leavesMaterial);
                    leaves.position.y = 5;

                    mesh = new THREE.Group();
                    mesh.add(trunk);
                    mesh.add(leaves);
                    mesh.scale.multiplyScalar(BASE_SCALE * 6);
                    break;

                case 'stone':
                    // Piedra: 2 veces más grande que la comida
                    const stoneGeometry = new THREE.DodecahedronGeometry(3, 0);
                    const stoneMaterial = new THREE.MeshStandardMaterial({ color: 0x808080 });
                    mesh = new THREE.Mesh(stoneGeometry, stoneMaterial);
                    mesh.scale.set(1, 0.7, 1);  // Aplanar un poco
                    mesh.scale.multiplyScalar(BASE_SCALE * 2);
                    break;

                case 'gold':
                    // Oro: 2 veces más grande que la comida
                    const goldGeometry = new THREE.DodecahedronGeometry(3, 0);
                    const goldMaterial = new THREE.MeshStandardMaterial({ color: 0xFFD700, metalness: 0.7, roughness: 0.3 });
                    mesh = new THREE.Mesh(goldGeometry, goldMaterial);
                    mesh.scale.multiplyScalar(BASE_SCALE * 2);
                    break;
            }

            mesh.position.set(
                Math.random() * terrainSize - halfSize,
                mesh.scale.y * 1.5, // Ajustar la altura según la escala
                Math.random() * terrainSize - halfSize
            );

            scene.add(mesh);
            resourceNodes.push({ type: type, mesh: mesh });
        }

        function updatePopulation() {
            document.getElementById('population').textContent = units.length;
        }

        function animate() {
            requestAnimationFrame(animate);
            updateCamera(); // Añade esta línea
            renderer.render(scene, camera);
        }

        // Event Listeners
        document.getElementById('advance-era').addEventListener('click', advanceEra);
        document.getElementById('open-config').addEventListener('click', () => {
            document.getElementById('config-menu').style.display = 'block';
        });
        document.getElementById('start-game').addEventListener('click', startGame);

        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        // Llame a updateUnitButtons() cuando se cargue la página
        document.addEventListener('DOMContentLoaded', () => {
            updateUnitButtons();
        });

        init();
    </script>
</body>

</html>
